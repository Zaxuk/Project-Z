# 系统现状快照

## 文档信息
- **日期**：2026-02-27
- **版本**：1.1
- **状态**：已批准

## 系统概览

ZClub 是一个面向家庭的积分管理系统，旨在通过积分机制激励孩子完成学习任务、家务劳动等活动。孩子可以通过完成任务赚取积分（称为Z币），并使用积分兑换游戏时间、零花钱、零食等奖励。

## 已完成的功能

### 1. 核心功能
- **用户管理**：支持多家长功能，角色包括管理员、普通家长和孩子，支持用户注册（默认注册为管理员）
- **任务管理**：支持学习、家务、行为和临时任务类型
- **积分管理**：任务审批后自动发放积分，积分可用于兑换奖励
- **奖励管理**：支持系统默认奖励和管理员自定义奖励
- **统计与报表**：积分统计和任务完成情况分析
- **通知系统**：任务、积分、奖励相关通知

### 2. 认证与授权
- **JWT认证**：实现基于JWT的认证机制，支持token生成和验证
- **登录状态持久化**：使用cookie存储token，支持浏览器重启后保持登录状态
- **SecurityContext集成**：创建UserPrincipal类存储用户认证信息（userId, email, role, familyId）
- **认证过滤器**：实现JwtAuthenticationFilter，自动验证请求中的token
- **权限控制**：基于角色的访问控制，保护API端点

### 3. 技术实现
- **后端**：Java + Spring Boot + H2（开发环境）+ Spring Security + JWT
- **前端**：Vue 3 + Vuex + Element Plus + Tailwind CSS + Axios
- **开发工具**：Maven + npm + Vite
- **部署**：Docker + Docker Compose（待配置）

### 4. 数据库设计
- 用户表 (users)
- 家庭表 (families)
- 任务表 (tasks)
- 任务完成记录表 (task_completions)
- 积分余额表 (point_balances)
- 积分记录表 (point_records)
- 奖励表 (rewards)
- 系统默认奖励表 (default_rewards)
- 奖励兑换表 (reward_redemptions)
- 通知表 (notifications)
- 任务审批等级表 (task_approval_levels)
- 系统设置表 (system_settings)

### 5. API实现状态

| 模块 | 状态 | 说明 |
|------|------|------|
| 认证API | 已完成 | 注册、登录、token验证 |
| 任务API | 已完成 | 创建、查询、完成任务 |
| 积分API | 已完成 | 积分查询、记录查询 |
| 奖励API | 已完成 | 奖励查询、兑换 |
| 通知API | 已完成 | 通知查询 |
| 用户API | 已完成 | 用户信息管理 |

### 6. 前端实现状态

| 页面/组件 | 状态 | 说明 |
|-----------|------|------|
| 登录对话框 | 已完成 | 支持登录和注册 |
| 任务管理 | 已完成 | 任务列表、创建任务 |
| 奖励管理 | 已完成 | 奖励列表、兑换奖励 |
| 积分查看 | 已完成 | 积分余额、积分记录 |
| 通知中心 | 已完成 | 通知列表 |

### 7. 业务流程
- **注册流程**：用户注册 → 系统自动创建Family → 设置为管理员角色 → 返回token → 自动登录
- **登录流程**：用户登录 → 验证密码 → 生成token → 存储cookie → 设置axios请求头
- **任务流程**：家长创建任务（自动获取familyId）→ 孩子完成任务 → 家长审批 → 发放积分
- **奖励兑换流程**：孩子直接兑换 → 系统自动扣除积分 → 记录奖励发放
- **多家长协作**：管理员邀请 → 普通家长加入 → 共同管理

## 待实现的功能

### 1. 核心功能
- 任务模板库
- 积分排行榜
- 成就系统
- 与智能家居设备集成
- 移动端应用
- 家长邀请功能

### 2. 技术实现
- 自动化测试（单元测试、集成测试）
- Docker部署配置
- 生产环境配置（MySQL、Redis）
- CI/CD流水线
- 日志聚合和监控

## 文档状态

| 文档名称 | 状态 | 版本 | 最后更新 |
|---------|------|------|----------|
| 功能需求文档 | 已完成 | 1.0 | 2026-02-27 |
| 非功能需求文档 | 已完成 | 1.0 | 2026-02-27 |
| 架构设计文档 | 已完成 | 1.0 | 2026-02-27 |
| 数据库设计文档 | 已完成 | 1.0 | 2026-02-27 |
| 技术栈选择 ADR | 已完成 | 1.0 | 2026-02-27 |
| API 文档 | 已完成 | 1.0 | 2026-02-27 |
| 系统现状快照 | 已完成 | 1.1 | 2026-02-27 |
| 变更日志 | 已完成 | 1.1 | 2026-02-27 |

## 关键决策

1. **技术栈选择**：Java + Spring Boot + Vue
2. **认证机制**：JWT + Cookie持久化
3. **数据库设计**：标准化状态字段，移除is_xxx字段
4. **开发环境**：H2内存数据库，方便调试
5. **奖励管理**：系统默认奖励和用户自定义奖励分离
6. **奖励兑换**：孩子直接兑换，无需家长审批
7. **任务流程**：家长审批并打分，系统根据积分倍率计算最终积分
8. **注册流程**：默认注册为管理员角色，自动创建Family
9. **familyId传递**：从SecurityContext获取，不从前端传递

## 风险与挑战

1. **数据安全**：确保孩子和家长数据的安全存储
2. **系统性能**：支持多用户并发操作
3. **用户体验**：确保界面简洁直观，适合孩子使用
4. **可扩展性**：为未来功能扩展预留接口
5. **H2数据库限制**：开发环境数据不持久化，重启后数据丢失

## 下一步计划

1. 完善自动化测试
2. 配置Docker部署
3. 实现家长邀请功能
4. 添加任务模板库
5. 实现积分排行榜
6. 添加成就系统
7. 优化UI/UX
8. 性能测试和优化